<!DOCTYPE html>
<html>
    <head>

        <title>Aufgaben - arrange</title>
        <link rel="icon" type="image/png" href="./images/to-do-list.png">
        <link rel="stylesheet" href="/styles/base.css">
        <script type="module">

            import { createListCard, createListAndDetailsCards } from '/js/cardhelper.mjs'

            // TODO: Aufgabenliste mit createListCard erstellen, wie die User-Features

            /********** Aufgabenlisten **********/

            async function createTodoListsCard() {

                let todoListsCard
                const todoListsReponse = await fetch('/api/todo/todolistforuser')
                if (todoListsReponse.status !== 200) return
                const todoLists = await todoListsReponse.json()
                // In Datenstruktur mappen
                const todoListsData = todoLists.map(todoList => {
                    return {
                        handler: createTodoListCard,
                        id: todoList.id,
                        name: todoList.name,
                        icon: './images/to-do-list.png'
                    }
                })
                const todoListsMetadata = {
                    listTitle: 'Aufgaben',
                    identifierPropertyName: 'id',
                    titlePropertyName: 'name',
                    iconPropertyName: 'icon'
                }
                const todoListSelectHandler = async function(selected_object) {
                    // Alle weiteren geöffneten Karten schließen
                    while (todoListsCard.nextSibling) {
                        todoListsCard.nextSibling.remove()
                    }
                    // Selektierte Karte anhand seines Handlers einbinden
                    const selectedCard = await selected_object.handler()
                    todoListsCard.parentNode.appendChild(selectedCard)
                }
                const todoListNewHandler = async function() {
                    // TODO: todoListNewHandler implementieren
                    // const detailsData = {} // Für den Anfang leer
                    // detailsCard = createDetailsCard(metadata.titlePropertyName, detailsData, detailsMetadata, internalSaveHandler, metadata.deleteApi ? internalDeleteHandler : undefined)
                    // // Erst mal alle Karten rechts neben der Listenkarte löschen
                    // while (listCard.nextSibling) listCard.nextSibling.remove()
                    // // Detailkarte rechts neben Listenkarte anzeigen
                    // listCard.parentNode.insertBefore(detailsCard, listCard.nextSibling)
                    // // Selektion in Liste entfernen
                    // listCard.querySelectorAll('input').forEach(input => input.checked = false)
                }
                todoListsCard = createListCard(todoListsData, todoListsMetadata, todoListSelectHandler, todoListNewHandler)
                document.body.appendChild(todoListsCard)

            }

            async function createTodoListCard() {
                // TODO: Aufgabenliste manuell erstellen, die Karte enthält ja eine dynamische Liste. Dazu die createInput() ... aus cardhelper exportieren bzw. in formhelper auslagern
            }

            createTodoListsCard()

        </script>

    </head>

    <body class="cards"></body>

</html>